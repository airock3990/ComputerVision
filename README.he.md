# זיהוי, מעקב וספירת אובייקטים עם YOLOv8, OpenCV, ByteTrack ו-Supervision

## מבוא

Ultralytics YOLOv8 היא הגרסה האחרונה של מודל זיהוי האובייקטים ופילוח התמונות YOLO (You Only Look Once) שפותח על ידי Ultralytics.

מודל YOLOv8 מעוצב להיות מהיר, מדויק וקל לשימוש, מה שהופך אותו לבחירה מצוינת למגוון רחב של משימות זיהוי אובייקטים ופילוח תמונות.

פרויקט זה מיועד לעיבוד צילומי וידאו לצורך זיהוי וספירת כלי רכב באמצעות YOLOv8. ניתן לשנות בקלות פרויקט זה כדי לשמש כבסיס לכל זיהוי וספירה נוספים שתרצה.

באמצעות מינוף טכניקות מתקדמות של למידת מכונה וספריות עיבוד וידאו חזקות, בדוגמה זו האפליקציה מספקת פתרון יעיל ומדויק לניטור זרימת תעבורה. בין אם אתה מבצע מחקרי תנועה, עוקב אחר שימוש בכבישים, או פשוט מעוניין בזיהוי כלי רכב, כלי זה מציע גישה מקיפה וניתנת להתאמה אישית. המערכת יכולה לזהות סוגים שונים של כלי רכב (מכוניות, אופנועים, אוטובוסים, משאיות) ולספור אותם כאשר הם חוצים קווים מוגדרים מראש בתוך מסגרות הוידאו, מה שהופך אותה לאידיאלית לניתוח ודיווח על תנועה.

## דיוק וצילומי דוגמה
דוגמה קצרה:
[![הדגמת וידאו](./github/youtube.png)](https://www.youtube.com/watch?v=UT4w8ZaC9ZI "הדגמת וידאו קצרה")

כפי שהוגדר, עם צילומי הדוגמה הללו הפרויקט מדויק מאוד. [בתוך סרטון 5 הדקות המלא](https://www.youtube.com/watch?v=XKMLWrsiHVg), 341 אובייקטים מזוהים ונספרים. הדיוק הכולל של הכלי הוא כ-98.24% באמצעות YOLOv8x.

ישנן השגיאות הבאות:
- נתיב שמאלי:
    - 3 החמצות:
        - אופנוע
        - משאית
        - משאית
- נתיב אמצעי:
    - 1 חיובי שגוי:
        - משאית
- נתיב ימני:
    - 2 החמצות:
        - משאית

עיבוד הוידאו לקח 2:22:27 על Apple M2 Pro 12 ליבות / 32 GB RAM.

## שימוש:
כפי שהוגדר, תוכנית זו מוגדרת להשתמש במודל YOLOv8 המאומן מראש, ולזהות רק כלי רכב.

אם ברצונך לשנות זאת, תוכל לעשות זאת על ידי עדכון מזהי המחלקה בתוך `app.py`.
```py
# Define vehicle class IDs (2: 'car', 3: 'motorcycle', 5: 'bus', 7: 'truck')
selected_classes = [2, 3, 5, 7]
```

אם אינך בטוח במזהי המחלקה ושמות המחלקות הרלוונטיים שלהם עבור מודל YOLOv8 שלך, תוכל להשתמש ב-`model-names.py` כדי לספק זאת עבורך.
```
python3 model-names.py
```

אם ברצונך ליצור מערך נתונים מותאם אישית משלך עבור YOLOv8, אנא עיין ב[פוסט זה מאת roboflow](https://blog.roboflow.com/how-to-train-yolov8-on-a-custom-dataset/).

## דרישות מערכת/חומרה
- אין דרישות חומרה ספציפיות.
- מערכת הפעלה: תואם לכל מערכת הפעלה שיכולה להריץ Python 3 (למשל, Windows, macOS, Linux).

## דרישות מוקדמות
- ודא שיש לך Python 3 מותקן במערכת שלך.
- ודא ש-ffmpeg מותקן וזמין ב-PATH של המערכת שלך. אתה יכול להוריד ולהתקין את ffmpeg מ[כאן.](https://www.ffmpeg.org/) זה נדרש רק אם משתמשים בסקריפט `youtube-dl.py` המסופק כדי לספק וידאו מקור לניתוח, אולם אינו נדרש לפונקציונליות הליבה של פרויקט זה.


## תלויות
האפליקציה דורשת את ספריות Python של צד שלישי הבאות:
- `NumPy`: משמש לפעולות מספריות וטיפול במערכים, במיוחד בסינון זיהויים על בסיס מזהי מחלקה. אתה יכול למצוא מידע נוסף על ספרייה זו [כאן.](https://github.com/numpy/numpy)
- `Supervision`: מספק כלי עזר לעיבוד וידאו, טיפול בזיהויים, מעקב אחר אובייקטים והוספת הערות למסגרות עם תיבות תוחמות ואזורי קווים. אתה יכול למצוא מידע נוסף על ספרייה זו [כאן.](https://github.com/roboflow/supervision)
- `Ultralytics`: משמש לטעינה והרצה של מודל YOLOv8 לזיהוי אובייקטים בזמן אמת במסגרות וידאו. אתה יכול למצוא מידע נוסף על ספרייה זו [כאן.](https://github.com/ultralytics/ultralytics/)
- `TQDM`: משמש להצגת סרגל התקדמות, המספק אינדיקציה חזותית להתקדמות עיבוד הוידאו. אתה יכול למצוא מידע נוסף על ספרייה זו [כאן.](https://github.com/tqdm/tqdm)
- `OpenCV-python`: משמש לקריאה וכתיבה של קבצי וידאו, ולכידה ועיבוד של מסגרות וידאו. אתה יכול למצוא מידע נוסף על ספרייה זו [כאן.](https://github.com/opencv/opencv-python)

בנוסף, אם נעשה שימוש ב-`youtube-dl.py` נדרש את הדברים הבאים:
- `yt-dlp`: משמש להורדת סרטונים מ-YouTube עם פורמטי פלט ושמות קבצים מוגדרים. אתה יכול למצוא מידע נוסף על ספרייה זו [כאן.](https://github.com/yt-dlp/yt-dlp)
- `ffmpeg`: משמש לחיתוך הוידאו שהורד לאורך מוגדר (30 שניות במקרה זה). אתה יכול למצוא מידע נוסף על ספרייה זו [כאן.](https://github.com/FFmpeg/FFmpeg)

## הוראות התקנה
1. **הורד את האפליקציה**:
   הורד את קובץ ה-ZIP של האפליקציה מהתפריט הנפתח הירוק ```Code``` שמסופק ב-GitHub, ובחר בהורדת ZIP. הוא נמצא בפינה הימנית העליונה של דף זה.

2. **חלץ את הקבצים**:
   חלץ את תכולת קובץ ה-ZIP לספרייה רצויה.

3. **הגדר venv והתקן דרישות**:
   פתח את הטרמינל שלך ונווט לספריית האפליקציה. הפעל את סקריפט ההתקנה על ידי ביצוע:
   ```
   bash setup.sh
   ```

   לחלופין:
   - צור והפעל סביבה וירטואלית:
    ```
    python3 -m venv .venv
    source .venv/bin/activate
    ```
    - התקן דרישות:
    ```
    pip3 install -r requirements.txt 
    ```
4. **הורד או ציין נתיב קובץ לסרטון רצוי**:
    בתוך `app.py`, שנה את השורות הבאות כך שיתאימו לסרטון שברצונך לנתח.
    ```py    
    # Define source and target video paths
    SOURCE_VIDEO_PATH = "/path/to/file"
    TARGET_VIDEO_PATH = "/path/to/file"
    ```
    אם ברצונך להשתמש בסרטון כפי שמוצג בדוגמה, הפעל את youtube-dl.py.
    ```
    python3 ./video/youtube-dl.py
    ```
5. **שנה מיקום קו לספירה (אופציונלי)**:
בסקריפט המסופק, נעשה שימוש בקווים לספירת כלי רכב החוצים אזורים ספציפיים בסרטון. אם אתה צריך לשנות קווים אלה, עקוב אחר השלבים שלהלן:

	1.	אתר את הגדרות הקו:
        בסקריפט, מצא את הקטע שבו מוגדרות נקודות ההתחלה והסוף של הקו. זה נראה כך:
    ```py 
        # Define line zones for counting
        LINE_START_ONE = sv.Point(250, 225)
        LINE_END_ONE = sv.Point(0, 175)

        LINE_START_TWO = sv.Point(375, 225)
        LINE_END_TWO = sv.Point(270, 225)

        LINE_START_THREE = sv.Point(600, 280)
        LINE_END_THREE = sv.Point(425, 230)
    ```
    2.	שנה את נקודות הקו:
    כדי לשנות את הקווים, עליך לעדכן את הקואורדינטות של הנקודות. הנקודות מוגדרות באמצעות תחביר sv.Point(x, y), כאשר x ו-y הם הקואורדינטות במסגרת הוידאו. שנה קואורדינטות אלו כדי להתאים לנקודות ההתחלה והסוף הרצויות עבור הקווים שלך.
    לדוגמה, כדי לשנות את הקו הראשון להתחיל ב-(300, 200) ולהסתיים ב-(50, 150), עדכן את הקוד כך:
    אתה יכול להסיר נקודות התחלה וסוף מיותרות עבור קווים עודפים.
    ```py
        # Define line zones for counting
        LINE_START_ONE = sv.Point(300, 200)
        LINE_END_ONE = sv.Point(50, 150)
    ```
    3.	עדכן את מופעי LineZone:
    כדי לשנות את הקווים לספירה, צור רק את מופע(י) LineZone הרצוי(ים). בדוגמה של קו אחד, הקטע צריך להיראות כך לאחר השינויים שלך:
    ```py
        # Create LineZone Instance
    line_zones = [
        sv.LineZone(start=LINE_START_ONE, end=LINE_END_ONE)
    ]
    ```
6. **ציין מודל YOLOv8**:
    המודלים יורדו בשימוש הראשון אם טרם הותקנו. בתוך הסקריפט תוכל לשנות את המודל על ידי עדכון נתיב הקובץ לשם המודל הרצוי.
    
    למשל:
    ```py
    # Load YOLO Model - extra large model size
    model = YOLO("./models/yolov8x.pt")
    ```
    יכול להיות מוחלף ב:
    ```py
      # Load YOLO Model - nano model size
        model = YOLO("./models/yolov8n.pt")
    ```

7. **הפעל את האפליקציה**:
לאחר השלמת ההתקנה, הפעל את האפליקציה על ידי הרצה:
    ```
    bash run.sh
    ```
    לחלופין:
    ```
    python3 app.py
    ```
    אם אתה רואה סרגל התקדמות מופיע, הצלחת.
    

## רישיון
מופץ תחת תנאי רישיון MIT

### תודה רבה!

